!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).fileUp=i()}(this,function(){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d={isObject:function(e){return"object"===r(e)&&!Array.isArray(e)&&null!==e},isNumeric:function(e){return("number"==typeof e||"string"==typeof e&&""!==e.trim())&&!isNaN(e)},getFileSize:function(e){return e instanceof File?e.size||e.fileSize:null},getFileName:function(e){return e instanceof File?e.name||e.fileName:null},getSizeHuman:function(e){var i;return d.isNumeric(e)?(i="",1073741824<=(e=Number(e))?i=(e/1073741824).toFixed(2)+" Gb":1048576<=e?i=(e/1048576).toFixed(2)+" Mb":1024<=e?i=(e/1024).toFixed(2)+" Kb":0<=e&&(i=e+" bytes"),i):""},hashCode:function(){return this.crc32(((new Date).getTime()+Math.random()).toString()).toString(16)},crc32:function(e){for(var i=[],t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;i[t]=r}for(var o=-1,s=0;s<e.length;s++)o=o>>>8^i[255&(o^e.charCodeAt(s))];return(-1^o)>>>0}},n=function(e){e=e.getElement();e&&(e.find(".fileup-upload").hide(),e.find(".fileup-abort").show(),e.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text(""))},o=function(e,i){i.lengthComputable&&(i=Math.ceil(i.loaded/i.total*100),e=e.getElement())&&e.find(".fileup-progress-bar").css("width",i+"%")},s=function(e){e=e.getElement();e&&(e.find(".fileup-abort").hide(),e.find(".fileup-upload").show(),e.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text(""))},l=function(e){var i,e=e.getElement();e&&(i=this.getLang(),e.find(".fileup-abort").hide(),e.find(".fileup-upload").hide(),e.find(".fileup-result").removeClass("fileup-error").addClass("fileup-success").text(i.complete))},a=function(e,i){var t=this.getLang();switch(e){case"files_limit":alert(t.errorFilesLimit.replace(/%filesLimit%/g,i.filesLimit));break;case"size_limit":var r=d.getSizeHuman(i.sizeLimit),n=t.errorSizeLimit;n=(n=n.replace(/%sizeLimit%/g,r)).replace(/%fileName%/g,d.getFileName(i.fileData)),alert(n);break;case"file_type":alert(t.errorFileType.replace(/%fileName%/g,d.getFileName(i.fileData)));break;case"load_bad_status":case"load_error":case"load_timeout":r=i.file.getElement();r&&(n="load_bad_status"===e?t.errorBadStatus:t.errorLoad,r.find(".fileup-abort").hide(),r.find(".fileup-upload").show(),r.find(".fileup-result").addClass("fileup-error").text(n));break;case"old_browser":alert(t.errorOldBrowser)}},f=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy";e=this.getDropzone();e&&e.addClass("over")},u=function(e){var i=this.getDropzone();i&&i.removeClass("over")},p=function(e){var i=this.getDropzone();i&&i.removeClass("over")},c=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},m={initInput:function(e){var i=null;if(e._options.input instanceof HTMLElement||e._options.input instanceof jQuery?i=$(e._options.input):"string"==typeof e._options.input&&e._options.input&&(i=$("#"+e._options.input)),!i||!$(i)[0]||"file"!==$(i)[0].type)throw new Error("Not found input element");e._input=i},initQueue:function(e){var i=null;if(e._options.queue instanceof HTMLElement||e._options.queue instanceof jQuery?i=$(e._options.queue):"string"==typeof e._options.queue&&e._options.queue&&(i=$("#"+e._options.queue)),!i||!$(i)[0])throw new Error("Not found queue element");e._queue=i},initDropzone:function(i){var t,e=null;i._options.dropzone instanceof HTMLElement||i._options.dropzone instanceof jQuery?e=$(i._options.dropzone):"string"==typeof i._options.dropzone&&i._options.dropzone&&(e=$("#"+i._options.dropzone)),e&&(i._dropzone=e,t=this,e.on("click",function(){i.getInput().click()}),e[0].addEventListener("dragover",function(e){t.trigger(i,"drag_over",[e])}),e[0].addEventListener("dragleave",function(e){t.trigger(i,"drag_leave",[e])}),e[0].addEventListener("dragenter",function(e){t.trigger(i,"drag_enter",[e])}),e[0].addEventListener("dragend",function(e){t.trigger(i,"drag_end",[e])}),e[0].addEventListener("drop",function(e){i.getInput()[0].files=e.target.files||e.dataTransfer.files,t.appendFiles(i,e)}))},initEvents:function(r){function e(e,i){var t=null;"function"==typeof i?t=i:"string"==typeof i&&(t=new Function(i)),t&&r.on(e,t)}var i=r.getOptions(),t=this;e("load_start",n),e("load_progress",o),e("load_abort",s),e("load_success",l),e("error",a),e("drag_over",f),e("drag_leave",c),e("drag_end",u),e("drag_enter",p),i.onSelect&&e("select",i.onSelect),i.onRemove&&e("remove",i.onRemove),i.onBeforeStart&&e("load_before_start",i.onBeforeStart),i.onStart&&e("load_start",i.onStart),i.onProgress&&e("load_progress",i.onProgress),i.onAbort&&e("load_abort",i.onAbort),i.onSuccess&&e("load_success",i.onSuccess),i.onFinish&&e("load_finish",i.onFinish),i.onError&&e("error",i.onError),i.onDragOver&&e("drag_over",i.onDragOver),i.onDragLeave&&e("drag_leave",i.onDragLeave),i.onDragEnd&&e("drag_end",i.onDragEnd),i.onDragEnter&&e("drag_enter",i.onDragEnter),r.getInput().on("change",function(e){t.appendFiles(r,e)})},renderFiles:function(e){var i=e.getOptions();if(Array.isArray(i.files)&&0<i.files.length)for(var t=0;t<i.files.length;t++)d.isObject(i.files[t])&&e.appendFileByData(i.files[t])},trigger:function(e,i,t){t=t||[];var r=[];if(e._events[i]instanceof Object&&0<e._events[i].length)for(var n=0;n<e._events[i].length;n++){var o=e._events[i][n].callback;r.push(o.apply(e._events[i][n].context||e,t)),e._events[i][n].singleExec&&(e._events[i].splice(n,1),n--)}return r},appendFiles:function(o,e){var s=this,l=(e.preventDefault(),e.stopPropagation(),o.getOptions()),a=o.getInput(),f=a[0].files,u=a.is("[multiple]");if(0<f.length){for(var p,i,c=0;c<f.length&&(0===(i=function(){var e=f[c];if(0<l.sizeLimit&&d.getFileSize(e)>l.sizeLimit)return s.trigger(o,"error",["size_limit",{fileData:e,sizeLimit:l.sizeLimit}]),0;if(0<l.filesLimit&&Object.keys(o._files).length>=l.filesLimit)return s.trigger(o,"error",["files_limit",{fileData:e,filesLimit:l.filesLimit}]),1;if("string"==typeof a[0].accept){var i=a[0].accept;if(i&&/[^\w]+/.test(i)){var t=!1,r=i.split(",");if(0<r.length)for(p=0;p<r.length;p++)if(r[p]=r[p].replace(/\s/g,""),new RegExp(r[p].replace("*",".*")).test(e.type)||new RegExp(r[p].replace(".",".*/")).test(e.type)){t=!0;break}if(!t)return s.trigger(o,"error",["file_type",{fileData:e}]),0}}i=s.trigger(o,"select",[e]);if(i){var n=!1;if($.each(i,function(e,i){if(!1===i)return!(n=!0)}),n)return 0}return u||o.removeAll(),o.appendFile(e),u?void 0:1}())||1!==i);c++);a.val("")}this.trigger(o,"dragEnd",[e])}},g={_options:{name:null,size:null,urlPreview:null,urlDownload:null},_id:"",_status:"stand_by",_fileElement:null,_file:null,_fileUp:null,_xhr:null,_init:function(i,e,t,r){if(!d.isObject(t))throw new Error("File incorrect options param");if("number"!=typeof e||e<0)throw new Error("File dont set or incorrect id param");if("string"!=typeof t.name||!t.name)throw new Error("File dont set name param");if(this._fileUp=i,this._options=$.extend(!0,{},this._options,t),this._id=e,r instanceof File){t=null;if(window.XMLHttpRequest)t=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){m.trigger(i,"error",["old_browser",{file:this}])}}else m.trigger(i,"error",["old_browser",{file:this}]);if(!t)throw new Error("xhr dont created. Check your browser");this._xhr=t,this._file=r}else this._status="finish"},getId:function(){return this._id},getName:function(){return this._file?d.getFileName(this._file):this._options.name},getElement:function(){return this._fileElement},getUrlPreview:function(){return this._options.urlPreview},getUrlDownload:function(){return this._options.urlDownload},getSize:function(){return this._file?d.getFileSize(this._file):this._options.size},getSizeHuman:function(){var e=this.getSize();return d.getSizeHuman(e)},getXhr:function(){return this._xhr},getFile:function(){return this._file instanceof File?this._file:null},getStatus:function(){return this._status},setStatus:function(e){"string"==typeof e&&(this._status=e)},getOptions:function(){return this._options},getOption:function(e){return"string"==typeof e&&this._options.hasOwnProperty(e)?this._options[e]:null},setOption:function(e,i){"string"==typeof e&&(this._options[e]=i)},showError:function(e){var i;"string"==typeof e&&(i=this.getElement())&&i.find(".fileup-result").removeClass("fileup-success").addClass("fileup-error").text(e)},showSuccess:function(e){var i;"string"==typeof e&&(i=this.getElement())&&i.find(".fileup-result").removeClass("fileup-error").addClass("fileup-success").text(e)},remove:function(){this.abort(),this._fileElement&&this._fileElement.fadeOut("fast",function(){this.remove()});var e=this.getId();this._fileUp._files.hasOwnProperty(e)&&delete this._fileUp._files[e],m.trigger(this._fileUp,"remove",[this])},upload:function(){var e,i,t,r=this.getFile(),n=this.getXhr();return!(!r||!n)&&(e=this._fileUp.getOptions(),i=this,"number"==typeof e.timeout&&(n.timeout=e.timeout),n.onloadstart=function(){i.setStatus("load_start"),m.trigger(i._fileUp,"load_start",[i])},n.upload.onprogress=function(e){m.trigger(i._fileUp,"load_progress",[i,e])},n.onload=function(){i.setStatus("loaded"),200===n.status?m.trigger(i._fileUp,"load_success",[i,n.responseText]):m.trigger(i._fileUp,"error",["load_bad_status",{file:i,fileData:r,response:n.responseText,xhr:n}])},n.onloadend=function(){i.setStatus("finish"),m.trigger(i._fileUp,"load_finish",[i])},n.onabort=function(){i.setStatus("stand_by"),m.trigger(i._fileUp,"load_abort",[i])},n.ontimeout=function(){i.setStatus("stand_by"),m.trigger(i._fileUp,"error",["load_timeout",{file:i,fileData:r}])},n.onerror=function(e){i.setStatus("stand_by"),m.trigger(i._fileUp,"error",["load_error",{file:i,fileData:r,event:e}])},n.open(e.httpMethod||"post",e.url,!0),n.setRequestHeader("Cache-Control","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.trigger(i._fileUp,"load_before_start",[i,n]),void 0!==window.FormData?((t=new FormData).append(e.fieldName,r),Object.keys(e.extraFields).length&&$.each(e.extraFields,function(e,i){t.append(e,i)}),n.send(t)):n.send(r))},abort:function(){this._xhr&&this._xhr.abort()},render:function(e){var i,t,r,n,o,s,l,a,f,u;return e&&"string"==typeof e?(u=this._fileUp.getLang(),o=this._fileUp.getOptions(),i=this,t=!1,r=d.isObject(o.mimeTypes)?o.mimeTypes:{},n="string"==typeof o.iconDefault?o.iconDefault:"",o="boolean"!=typeof o.showRemove||o.showRemove,s=this.getSizeHuman(),f=a=l=null,e=(e=(e=(e=(e=e.replace(/\[NAME\]/g,this.getName())).replace(/\[SIZE\]/g,s)).replace(/\[UPLOAD\]/g,u.upload)).replace(/\[REMOVE\]/g,u.remove)).replace(/\[ABORT\]/g,u.abort),this._file&&this._file instanceof File?this._file.type&&"string"==typeof this._file.type&&this._file.type.match(/^image\/.*/)?("undefined"!=typeof FileReader&&((u=new FileReader).onload=function(e){i._fileElement&&i._fileElement.find(".fileup-preview").removeClass("no-preview").find("img").attr("src",e.target.result)},u.readAsDataURL(this._file)),t=!0,e=(e=e.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-image fileup-no-preview")):(e=(e=e.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-doc"),a=this._file.type,f=this.getName().split(".").pop()):(u=this.getUrlPreview(),e=(e=e.replace(/\[PREVIEW_SRC\]/g,u||"")).replace(/\[TYPE\]/g,u?"fileup-image":"fileup-doc"),f=this.getName()?this.getName().split(".").pop().toLowerCase():""),this._fileElement=$(e),t&&this._fileElement.find(".fileup-preview").addClass("no-preview"),s||this._fileElement.find(".fileup-size").hide(),(a||f)&&$.each(r,function(e,t){if(d.isObject(t)&&t.hasOwnProperty("icon")&&"string"==typeof t.icon&&""!==t.icon){if(a&&t.hasOwnProperty("mime"))if("string"==typeof t.mime){if(t.mime===a)return l=t.icon,!1}else if(Array.isArray(t.mime)){if($.each(t.mime,function(e,i){if("string"==typeof i&&i===a)return l=t.icon,!1}),l)return!1}else if(t.mime instanceof RegExp&&t.mime.test(a))return l=t.icon,!1;return!(f&&t.hasOwnProperty("ext")&&Array.isArray(t.ext)&&($.each(t.ext,function(e,i){if("string"==typeof i&&i===f)return l=t.icon,!1}),l))&&void 0}}),l=l||n,this._fileElement.find(".fileup-icon").addClass(l),o||this._fileElement.find(".fileup-remove").hide(),this.getUrlDownload()&&(u=this._fileElement.find(".fileup-name"))[0]&&u.replaceWith('<a href="'+this.getUrlDownload()+'" class="fileup-name" download="'+this.getName()+'">'+this.getName()+"</a>"),"finish"===this._status?(this._fileElement.find(".fileup-upload").hide(),this._fileElement.find(".fileup-abort").hide(),this._fileElement.find(".fileup-progress").hide()):(this._fileElement.find(".fileup-upload").click(function(){i.upload()}),this._fileElement.find(".fileup-abort").click(function(){i.abort()})),this._fileElement.find(".fileup-remove").click(function(){i.remove()}),this._fileElement):null}},t=Object.create(null),h={_options:{id:null,url:null,input:null,queue:null,dropzone:null,files:[],fieldName:"file",extraFields:{},lang:"en",langItems:null,sizeLimit:0,filesLimit:0,httpMethod:"post",timeout:null,autostart:!(t["file.html"]='<div class="fileup-file [TYPE] mb-2 p-1 d-flex flex-nowrap gap-2 bg-light border border-secondary-subtle rounded rounded-1"> <div class="fileup-preview"> <img src="[PREVIEW_SRC]" alt="[NAME]" class="border rounded"/> <i class="fileup-icon fs-4 text-secondary"></i> </div> <div class="flex-fill"> <div class="fileup-description"> <span class="fileup-name">[NAME]</span> <small class="fileup-size text-nowrap text-secondary">([SIZE])</small> </div> <div class="fileup-controls mt-1 d-flex gap-2"> <span class="fileup-remove" title="[REMOVE]">✕</span> <span class="fileup-upload link-primary">[UPLOAD]</span> <span class="fileup-abort link-primary" style="display:none">[ABORT]</span> </div> <div class="fileup-result"></div> <div class="fileup-progress progress mt-2 mb-1"> <div class="fileup-progress-bar progress-bar"></div> </div> </div> </div>'),showRemove:!0,templateFile:null,onSelect:null,onRemove:null,onBeforeStart:null,onStart:null,onProgress:null,onAbort:null,onSuccess:null,onFinish:null,onError:null,onDragOver:null,onDragLeave:null,onDragEnd:null,onDragEnter:null,iconDefault:"bi bi-file-earmark-text",mimeTypes:{archive:{mime:["application/zip","application/gzip","application/x-bzip","application/x-bzip2","application/x-7z-compressed"],ext:["zip","7z","bz","bz2","gz","jar","rar","tar"],icon:"bi bi-file-earmark-zip"},word:{mime:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],ext:["doc","docx"],icon:"bi bi-file-earmark-word"},excel:{mime:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ext:["xls","xlsx"],icon:"bi bi-file-earmark-excel"},image:{mime:/image\/.*/,ext:["jpg","jpeg","png","bmp","gif","raw","webp","heic","ico"],icon:"bi bi-file-earmark-image"},video:{mime:/video\/.*/,ext:["avi","mp4","mpeg","ogv","ts","webm","3gp","3g2","mkv"],icon:"bi bi-file-earmark-play"},audio:{mime:/audio\/.*/,ext:["avi","mp4","mpeg","ogv","ts","webm","3gp","3g2","mkv"],icon:"bi bi-file-earmark-music"},pdf:{mime:["application/pdf"],ext:["pdf"],icon:"bi bi-file-earmark-pdf"},binary:{mime:["application/octet-stream"],ext:["bin","exe","dat","dll"],icon:"bi bi-file-earmark-binary"}}},_id:null,_fileUp:null,_fileIndex:0,_input:null,_queue:null,_dropzone:null,_files:{},_events:{},_init:function(e,i){if("string"!=typeof i.url||!i.url)throw new Error("Dont set url param");this._fileUp=e,this._options=$.extend(!0,{},this._options,i),this._id="string"==typeof this._options.id&&this._options.id?this._options.id:d.hashCode(),this._options.templateFile&&"string"==typeof this._options.templateFile||(this._options.templateFile=t["file.html"]),m.initInput(this),m.initQueue(this),m.initDropzone(this),m.initEvents(this),m.renderFiles(this)},destruct:function(){var e=this.getId();this._fileUp._instances.hasOwnProperty(e)&&delete this._fileUp._instances[e]},getOptions:function(){return this._options},getId:function(){return this._id},getInput:function(){return this._input},getQueue:function(){return this._queue},getDropzone:function(){return this._dropzone},on:function(e,i,t){"object"!==r(this._events[e])&&(this._events[e]=[]),this._events[e].push({context:t||this,callback:i,singleExec:!1})},one:function(e,i,t){"object"!==r(this._events[e])&&(this._events[e]=[]),this._events[e].push({context:t||this,callback:i,singleExec:!0})},getLang:function(){return $.extend(!0,{},this._options.langItems)},getFiles:function(){return this._files},getFileById:function(t){var r=null;return $.each(this._files,function(e,i){t===i.getId()&&(r=i)}),r},removeAll:function(){$.each(this._files,function(e,i){i.remove()})},uploadAll:function(){$.each(this._files,function(e,i){i.upload()})},abortAll:function(){$.each(this._files,function(e,i){i.abort()})},appendFile:function(e){var i,t;return e instanceof File&&(i=$.extend(!0,{},g),t={name:d.getFileName(e),size:d.getFileSize(e),type:e.type},i._init(this,this._fileIndex,t,e),this._files[this._fileIndex]=i,(t=this.getQueue())&&t.append(i.render(this._options.templateFile)),this._fileIndex++,"boolean"==typeof this._options.autostart&&this._options.autostart&&i.upload(),!0)},appendFileByData:function(e){var i;return!!d.isObject(e)&&((i=$.extend(!0,{},g))._init(this,this._fileIndex,e),i.setStatus("finish"),this._files[this._fileIndex]=i,(e=this.getQueue())&&e.append(i.render(this._options.templateFile)),this._fileIndex++,!0)}},e={lang:{},_instances:{},create:function(e){(e=d.isObject(e)?e:{}).hasOwnProperty("lang")||(e.lang="en");var i=this.lang.hasOwnProperty(e.lang)?this.lang[e.lang]:{},i=(e.langItems=e.hasOwnProperty("langItems")&&d.isObject(e.langItems)?$.extend(!0,{},i,e.langItems):i,$.extend(!0,{},h)),e=(i._init(this,e),i.getId());return this._instances[e]=i},get:function(e){return this._instances.hasOwnProperty(e)?$.contains(document,this._instances[e]._input[0])?this._instances[e]:(delete this._instances[e],null):null}};return e.lang.en={upload:"Upload",abort:"Abort",remove:"Remove",complete:"Complete",error:"Error",errorLoad:"Error uploading file",errorBadStatus:"Error uploading file. Bad request.",errorFilesLimit:"The number of selected files exceeds the limit (%filesLimit%)",errorSizeLimit:'File "%fileName%" exceeds the size limit (%sizeLimit%)',errorFileType:'File "%fileName%" is incorrect',errorOldBrowser:"Your browser can not upload files. Update to the latest version"},e.lang.ru={upload:"Загрузить",abort:"Остановить",remove:"Удалить",complete:"Готово",error:"Ошибка",errorLoad:"Ошибка при загрузке файла",errorBadStatus:"Ошибка при загрузке файла. Некорректный запрос.",errorFilesLimit:"Количество выбранных файлов превышает лимит (%filesLimit%)",errorSizeLimit:'Файл "%fileName%" превышает предельный размер (%sizeLimit%)',errorFileType:'Файл "%fileName%" является некорректным',errorOldBrowser:"Обновите ваш браузер до последней версии"},e.lang.es={upload:"Subir",abort:"Cancelar",remove:"Eliminar",complete:"Cargado",error:"Error",errorLoad:"Error al cargar el archivo",errorBadStatus:"Error al cargar el archivo. Solicitud no válida.",errorFilesLimit:"El número de archivo selecccionados excede el límite (%filesLimit%)",errorSizeLimit:'El archivo "%fileName%" excede el limite de tamaño (%sizeLimit%)',errorFileType:'El archivo "%fileName%" es inválido',errorOldBrowser:"Tu navegador no puede subir archivos. Actualiza a la última versión"},e.lang.pt={upload:"Enviar",abort:"Cancelar",remove:"Remover",complete:"Enviado",error:"Erro",errorLoad:"Erro ao carregar o arquivo",errorBadStatus:"Erro ao carregar o arquivo. Pedido inválido.",errorFilesLimit:"O número de arquivos selecionados excede o limite (%filesLimit%)",errorSizeLimit:'Arquivo "%fileName%" excede o limite (%sizeLimit%)',errorFileType:'Arquivo "%fileName%" inválido',errorOldBrowser:"Seu navegador não pode enviar os arquivos. Atualize para a versão mais recente"},e});
//# sourceMappingURL=fileup.min.js.map

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).fileUp=t()}(this,function(){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c={isObject:function(e){return"object"===r(e)&&!Array.isArray(e)&&null!==e},isNumeric:function(e){return("number"==typeof e||"string"==typeof e&&""!==e.trim())&&!isNaN(e)},getFileSize:function(e){return e instanceof File?e.size||e.fileSize:null},getFileName:function(e){return e instanceof File?e.name||e.fileName:null},getSizeHuman:function(e){var t;return c.isNumeric(e)?(t="",1073741824<=(e=Number(e))?t=(e/1073741824).toFixed(2)+" Gb":1048576<=e?t=(e/1048576).toFixed(2)+" Mb":1024<=e?t=(e/1024).toFixed(2)+" Kb":0<=e&&(t=e+" bytes"),t):""},hashCode:function(){return this.crc32(((new Date).getTime()+Math.random()).toString()).toString(16)},crc32:function(e){for(var t=[],i=0;i<256;i++){for(var r=i,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;t[i]=r}for(var o=-1,l=0;l<e.length;l++)o=o>>>8^t[255&(o^e.charCodeAt(l))];return(-1^o)>>>0}},o={_options:{id:null,name:null,type:null,size:null,status:null,urlPreview:null,urlDownload:null},_id:"",_status:"stand_by",_fileElement:null,_fileData:null,_fileUp:null,_xhr:null,_init:function(t,i,e){if(!c.isObject(i))throw new Error("File incorrect options param");if("number"!=typeof i.id||i.id<0)throw new Error("File dont set or incorrect id param");if("string"!=typeof i.name||!i.name)throw new Error("File dont set name param");if(this._fileUp=t,this._options=$.extend(!0,{},this._options,i),this._id=this._options.id,this._status="string"==typeof this._options.status&&this._options.status?this._options.status:"stand_by",e instanceof File){i=null;if(window.XMLHttpRequest)i=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);else if(window.ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){g.trigger(t,"error",["old_browser",{file:this}])}}else g.trigger(t,"error",["old_browser",{file:this}]);if(!i)throw new Error("xhr dont created. Check your browser");this._xhr=i,this._fileData=e}else this._status="finish"},getId:function(){return this._id},getName:function(){return this._fileData?c.getFileName(this._fileData):this._options.name},getElement:function(){return this._fileElement},getUrlPreview:function(){return this._options.urlPreview},getUrlDownload:function(){return this._options.urlDownload},getSize:function(){return this._fileData?c.getFileSize(this._fileData):this._options.size},getSizeHuman:function(){var e=this.getSize();return c.getSizeHuman(e)},getXhr:function(){return this._xhr},getFileData:function(){return this._fileData instanceof File?this._fileData:null},getStatus:function(){return this._status},setStatus:function(e){"string"==typeof e&&(this._status=e)},showError:function(e){var t;"string"==typeof e&&(t=this.getElement())&&t.find(".fileup-result").removeClass("fileup-success").addClass("fileup-error").text(e)},showSuccess:function(e){var t;"string"==typeof e&&(t=this.getElement())&&t.find(".fileup-result").removeClass("fileup-error").addClass("fileup-success").text(e)},remove:function(){this.abort(),this._fileElement&&this._fileElement.fadeOut("fast",function(){this.remove()});var e=this.getId();this._fileUp._files.hasOwnProperty(e)&&delete this._fileUp._files[e],g.trigger(this._fileUp,"remove",[this])},upload:function(){var e,t,i,r=this.getFileData(),n=this.getXhr();return!(!r||!n)&&(e=this._fileUp.getOptions(),t=this,"number"==typeof e.timeout&&(n.timeout=e.timeout),n.onloadstart=function(){t.setStatus("load_start"),g.trigger(t._fileUp,"load_start",[t])},n.upload.onprogress=function(e){g.trigger(t._fileUp,"load_progress",[t,e])},n.onload=function(){t.setStatus("loaded"),200===n.status?g.trigger(t._fileUp,"load_success",[t,n.responseText]):g.trigger(t._fileUp,"error",["load_bad_status",{file:t,fileData:r,response:n.responseText,xhr:n}])},n.onloadend=function(){t.setStatus("finish"),g.trigger(t._fileUp,"load_finish",[t])},n.onabort=function(){t.setStatus("stand_by"),g.trigger(t._fileUp,"load_abort",[t])},n.ontimeout=function(){t.setStatus("stand_by"),g.trigger(t._fileUp,"error",["load_timeout",{file:t,fileData:r}])},n.onerror=function(e){t.setStatus("stand_by"),g.trigger(t._fileUp,"error",["load_error",{file:t,fileData:r,event:e}])},n.open(e.httpMethod||"post",e.url,!0),n.setRequestHeader("Cache-Control","no-cache"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.trigger(t._fileUp,"load_before_start",[t,n]),void 0!==window.FormData?((i=new FormData).append(e.fieldName,r),Object.keys(e.extraFields).length&&$.each(e.extraFields,function(e,t){i.append(e,t)}),n.send(i)):n.send(r))},abort:function(){this._xhr&&this._xhr.abort()},render:function(e){var t,i,r,n,o,l,s,a,f,u;return e&&"string"==typeof e?(u=this._fileUp.getLang(),o=this._fileUp.getOptions(),t=this,i=!1,r=c.isObject(o.mimeTypes)?o.mimeTypes:{},n="string"==typeof o.iconDefault?o.iconDefault:"",o="boolean"!=typeof o.showClose||o.showClose,l=this.getSizeHuman(),f=a=s=null,e=(e=(e=(e=(e=(e=e.replace(/\[ID\]/g,this.getId())).replace(/\[NAME\]/g,this.getName())).replace(/\[SIZE\]/g,l)).replace(/\[UPLOAD\]/g,u.upload)).replace(/\[REMOVE\]/g,u.remove)).replace(/\[ABORT\]/g,u.abort),this._fileData&&this._fileData instanceof File?this._fileData.type&&"string"==typeof this._fileData.type&&this._fileData.type.match(/^image\/.*/)?("undefined"!=typeof FileReader&&((u=new FileReader).onload=function(e){t._fileElement&&t._fileElement.find(".fileup-preview").removeClass("no-preview").find("img").attr("src",e.target.result)},u.readAsDataURL(this._fileData)),i=!0,e=(e=e.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-image fileup-no-preview")):(e=(e=e.replace(/\[PREVIEW_SRC\]/g,"")).replace(/\[TYPE\]/g,"fileup-doc"),a=this._fileData.type,f=this.getName().split(".").pop()):(u=this.getUrlPreview(),e=(e=e.replace(/\[PREVIEW_SRC\]/g,u||"")).replace(/\[TYPE\]/g,u?"fileup-image":"fileup-doc"),f=this.getName()?this.getName().split(".").pop():""),this._fileElement=$(e),i&&this._fileElement.find(".fileup-preview").addClass("no-preview"),l||this._fileElement.find(".fileup-size").hide(),(a||f)&&$.each(r,function(e,i){if(c.isObject(i)&&i.hasOwnProperty("icon")&&"string"==typeof i.icon&&""!==i.icon){if(a&&i.hasOwnProperty("mime"))if("string"==typeof i.mime){if(i.mime===a)return s=i.icon,!1}else if(Array.isArray(i.mime)){if($.each(i.mime,function(e,t){if("string"==typeof t&&t===a)return s=i.icon,!1}),s)return!1}else if(i.mime instanceof RegExp&&i.mime.test(a))return s=i.icon,!1;return!(f&&i.hasOwnProperty("ext")&&Array.isArray(i.ext)&&($.each(i.ext,function(e,t){if("string"==typeof t&&t===f)return s=i.icon,!1}),s))&&void 0}}),s=s||n,this._fileElement.find(".fileup-icon").addClass(s),o||this._fileElement.find(".fileup-remove").hide(),this.getUrlDownload()&&(u=this._fileElement.find(".fileup-name"))[0]&&u.replaceWith('<a href="'+this.getUrlDownload()+'" class="fileup-name" download="'+this.getName()+'">'+this.getName()+"</a>"),"finish"===this._status?(this._fileElement.find(".fileup-upload").hide(),this._fileElement.find(".fileup-abort").hide(),this._fileElement.find(".fileup-progress").hide()):(this._fileElement.find(".fileup-upload").click(function(){t.upload()}),this._fileElement.find(".fileup-abort").click(function(){t.abort()})),this._fileElement.find(".fileup-remove").click(function(){t.remove()}),this._fileElement):null}},n=function(e){e=e.getElement();e&&(e.find(".fileup-upload").hide(),e.find(".fileup-abort").show(),e.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text(""))},l=function(e,t){t.lengthComputable&&(t=Math.ceil(t.loaded/t.total*100),e=e.getElement())&&e.find(".fileup-progress-bar").css("width",t+"%")},s=function(e){e=e.getElement();e&&(e.find(".fileup-abort").hide(),e.find(".fileup-upload").show(),e.find(".fileup-result").removeClass("fileup-error").removeClass("fileup-success").text(""))},a=function(e){var t,e=e.getElement();e&&(t=this.getLang(),e.find(".fileup-abort").hide(),e.find(".fileup-upload").hide(),e.find(".fileup-result").removeClass("fileup-error").addClass("fileup-success").text(t.complete))},f=function(e,t){var i=this.getLang();switch(e){case"files_limit":alert(i.errorFilesLimit.replace(/%filesLimit%/g,t.filesLimit));break;case"size_limit":var r=c.getSizeHuman(t.sizeLimit),n=i.errorSizeLimit;n=(n=n.replace(/%sizeLimit%/g,r)).replace(/%fileName%/g,c.getFileName(t.fileData)),alert(n);break;case"file_type":alert(i.errorFileType.replace(/%fileName%/g,c.getFileName(t.fileData)));break;case"load_bad_status":case"load_error":case"load_timeout":r=t.file.getElement();r&&(n="load_bad_status"===e?i.errorBadStatus:i.errorLoad,r.find(".fileup-abort").hide(),r.find(".fileup-upload").show(),r.find(".fileup-result").addClass("fileup-error").text(n));break;case"old_browser":alert(i.errorOldBrowser)}},u=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy";e=this.getDropzone();e&&e.addClass("over")},p=function(e){var t=this.getDropzone();t&&t.removeClass("over")},d=function(e){var t=this.getDropzone();t&&t.removeClass("over")},m=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},g={initInput:function(e){var t=null;if(e._options.input instanceof HTMLElement||e._options.input instanceof jQuery?t=$(e._options.input):"string"==typeof e._options.input&&e._options.input&&(t=$("#"+e._options.input)),!t||!$(t)[0]||"file"!==$(t)[0].type)throw new Error("Not found input element");e._input=t},initQueue:function(e){var t=null;if(e._options.queue instanceof HTMLElement||e._options.queue instanceof jQuery?t=$(e._options.queue):"string"==typeof e._options.queue&&e._options.queue&&(t=$("#"+e._options.queue)),!t||!$(t)[0])throw new Error("Not found queue element");e._queue=t},initDropzone:function(t){var i,e=null;t._options.dropzone instanceof HTMLElement||t._options.dropzone instanceof jQuery?e=$(t._options.dropzone):"string"==typeof t._options.dropzone&&t._options.dropzone&&(e=$("#"+t._options.dropzone)),e&&(t._dropzone=e,i=this,e.on("click",function(){t.getInput().click()}),e[0].addEventListener("dragover",function(e){i.trigger(t,"drag_over",[e])}),e[0].addEventListener("dragleave",function(e){i.trigger(t,"drag_leave",[e])}),e[0].addEventListener("dragenter",function(e){i.trigger(t,"drag_enter",[e])}),e[0].addEventListener("dragend",function(e){i.trigger(t,"drag_end",[e])}),e[0].addEventListener("drop",function(e){t.getInput()[0].files=e.target.files||e.dataTransfer.files,i.appendFiles(t,e)}))},initEvents:function(r){function e(e,t){var i=null;"function"==typeof t?i=t:"string"==typeof t&&(i=new Function(t)),i&&r.on(e,i)}var t=r.getOptions(),i=this;e("load_start",n),e("load_progress",l),e("load_abort",s),e("load_success",a),e("error",f),e("drag_over",u),e("drag_leave",m),e("drag_end",p),e("drag_enter",d),t.onSelect&&e("select",t.onSelect),t.onRemove&&e("remove",t.onRemove),t.onBeforeStart&&e("load_before_start",t.onBeforeStart),t.onStart&&e("load_start",t.onStart),t.onProgress&&e("load_progress",t.onProgress),t.onAbort&&e("load_abort",t.onAbort),t.onSuccess&&e("load_success",t.onSuccess),t.onFinish&&e("load_finish",t.onFinish),t.onError&&e("error",t.onError),t.onDragOver&&e("drag_over",t.onDragOver),t.onDragLeave&&e("drag_leave",t.onDragLeave),t.onDragEnd&&e("drag_end",t.onDragEnd),t.onDragEnter&&e("drag_enter",t.onDragEnter),r.getInput().on("change",function(e){i.appendFiles(r,e)})},renderFiles:function(e){var t=e.getOptions();if(Array.isArray(t.files)&&0<t.files.length)for(var i=0;i<t.files.length;i++)c.isObject(t.files[i])&&(t.files[i].id=e._fileIndex,t.files[i].status="loaded",this.appendFileByData(e,t.files[i]))},trigger:function(e,t,i){i=i||[];var r=[];if(e._events[t]instanceof Object&&0<e._events[t].length)for(var n=0;n<e._events[t].length;n++){var o=e._events[t][n].callback;r.push(o.apply(e._events[t][n].context||e,i)),e._events[t][n].singleExec&&(e._events[t].splice(n,1),n--)}return r},appendFiles:function(o,e){var l=this,s=(e.preventDefault(),e.stopPropagation(),o.getOptions()),a=o.getInput(),f=a[0].files,u=a.is("[multiple]");if(0<f.length){for(var p,t,d=0;d<f.length&&(0===(t=function(){var e=f[d];if(0<s.sizeLimit&&c.getFileSize(e)>s.sizeLimit)return l.trigger(o,"error",["size_limit",{fileData:e,sizeLimit:s.sizeLimit}]),0;if(0<s.filesLimit&&Object.keys(o._files).length>=s.filesLimit)return l.trigger(o,"error",["files_limit",{fileData:e,filesLimit:s.filesLimit}]),1;if("string"==typeof a[0].accept){var t=a[0].accept;if(t&&/[^\w]+/.test(t)){var i=!1,r=t.split(",");if(0<r.length)for(p=0;p<r.length;p++)if(r[p]=r[p].replace(/\s/g,""),new RegExp(r[p].replace("*",".*")).test(e.type)||new RegExp(r[p].replace(".",".*/")).test(e.type)){i=!0;break}if(!i)return l.trigger(o,"error",["file_type",{fileData:e}]),0}}t=l.trigger(o,"select",[e]);if(t){var n=!1;if($.each(t,function(e,t){if(!1===t)return!(n=!0)}),n)return 0}return u||o.removeAll(),l.appendFile(o,e),u?void 0:1}())||1!==t);d++);a.val("")}this.trigger(o,"dragEnd",[e])},appendFile:function(e,t){var i=e.getOptions(),r=$.extend(!0,{},o),n={id:e._fileIndex,name:c.getFileName(t),size:c.getFileSize(t),type:t.type},n=(r._init(e,n,t),e._files[e._fileIndex]=r,e.getQueue());n&&n.append(r.render(i.templateFile)),e._fileIndex++,"boolean"==typeof e._options.autostart&&e._options.autostart&&r.upload()},appendFileByData:function(e,t){var i=e.getOptions(),r=$.extend(!0,{},o),t=(r._init(e,t),e._files[e._fileIndex]=r,e.getQueue());t&&t.append(r.render(i.templateFile)),e._fileIndex++}},t=Object.create(null),i={_options:{id:null,url:null,input:null,queue:null,dropzone:null,files:[],fieldName:"file",extraFields:{},lang:"en",langItems:null,sizeLimit:0,filesLimit:0,httpMethod:"post",timeout:null,autostart:!(t["file.html"]='<div class="fileup-file [TYPE] mb-2 p-1 d-flex flex-nowrap gap-2 bg-light border border-secondary-subtle rounded rounded-1"> <div class="fileup-preview"> <img src="[PREVIEW_SRC]" alt="[NAME]" class="border rounded"/> <i class="fileup-icon fs-4 text-secondary"></i> </div> <div class="flex-fill"> <div class="fileup-description"> <span class="fileup-name">[NAME]</span> <small class="fileup-size text-nowrap text-secondary">([SIZE])</small> </div> <div class="fileup-controls mt-1 d-flex gap-2"> <span class="fileup-remove" title="[REMOVE]">✕</span> <span class="fileup-upload link-primary">[UPLOAD]</span> <span class="fileup-abort link-primary" style="display:none">[ABORT]</span> </div> <div class="fileup-result"></div> <div class="fileup-progress progress mt-2 mb-1"> <div class="fileup-progress-bar progress-bar"></div> </div> </div> </div>'),showClose:!0,templateFile:null,onSelect:null,onRemove:null,onBeforeStart:null,onStart:null,onProgress:null,onAbort:null,onSuccess:null,onFinish:null,onError:null,onDragOver:null,onDragLeave:null,onDragEnd:null,onDragEnter:null,iconDefault:"bi bi-file-earmark-text",mimeTypes:{archive:{mime:["application/zip","application/gzip","application/x-bzip","application/x-bzip2","application/x-7z-compressed"],ext:["zip","7z","bz","bz2","gz","jar","rar","tar"],icon:"bi bi-file-earmark-zip"},word:{mime:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],ext:["doc","docx"],icon:"bi bi-file-earmark-word"},excel:{mime:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ext:["xls","xlsx"],icon:"bi bi-file-earmark-excel"},video:{mime:/video\/.*/,ext:["avi","mp4","mpeg","ogv","ts","webm","3gp","3g2","mkv"],icon:"bi bi-file-earmark-play"},audio:{mime:/audio\/.*/,ext:["avi","mp4","mpeg","ogv","ts","webm","3gp","3g2","mkv"],icon:"bi bi-file-earmark-music"},pdf:{mime:["application/pdf"],ext:["pdf"],icon:"bi bi-file-earmark-pdf"},binary:{mime:["application/octet-stream"],ext:["bin","exe","dat","dll"],icon:"bi bi-file-earmark-binary"}}},_id:null,_fileIndex:0,_input:null,_queue:null,_dropzone:null,_files:{},_events:{},_init:function(e){if("string"!=typeof e.url||!e.url)throw new Error("Dont set url param");this._options=$.extend(!0,{},this._options,e),this._id="string"==typeof this._options.id&&this._options.id?this._options.id:c.hashCode(),this._options.templateFile&&"string"==typeof this._options.templateFile||(this._options.templateFile=t["file.html"]),g.initInput(this),g.initQueue(this),g.initDropzone(this),g.initEvents(this),g.renderFiles(this)},getOptions:function(){return this._options},getId:function(){return this._id},getInput:function(){return this._input},getQueue:function(){return this._queue},getDropzone:function(){return this._dropzone},on:function(e,t,i){"object"!==r(this._events[e])&&(this._events[e]=[]),this._events[e].push({context:i||this,callback:t,singleExec:!1})},one:function(e,t,i){"object"!==r(this._events[e])&&(this._events[e]=[]),this._events[e].push({context:i||this,callback:t,singleExec:!0})},getLang:function(){return $.extend(!0,{},this._options.langItems)},getFiles:function(){return this._files},getFileById:function(i){var r=null;return $.each(this._files,function(e,t){i===t.getId()&&(r=t)}),r},removeAll:function(){$.each(this._files,function(e,t){t.remove()})},uploadAll:function(){$.each(this._files,function(e,t){t.upload()})},abortAll:function(){$.each(this._files,function(e,t){t.abort()})}},e={lang:{},_instances:{},create:function(e){(e=c.isObject(e)?e:{}).hasOwnProperty("lang")||(e.lang="en");var t=this.lang.hasOwnProperty(e.lang)?this.lang[e.lang]:{},t=(e.langItems=e.hasOwnProperty("langItems")&&c.isObject(e.langItems)?$.extend(!0,{},t,e.langItems):t,$.extend(!0,{},i)),e=(t._init(e),t.getId());return this._instances[e]=t},get:function(e){return this._instances.hasOwnProperty(e)?$.contains(document,this._instances[e]._input[0])?this._instances[e]:(delete this._instances[e],null):null}};return e.lang.en={upload:"Upload",abort:"Abort",remove:"Remove",complete:"Complete",error:"Error",errorLoad:"Error uploading file",errorBadStatus:"Error uploading file. Bad request.",errorFilesLimit:"The number of selected files exceeds the limit (%filesLimit%)",errorSizeLimit:'File "%fileName%" exceeds the size limit (%sizeLimit%)',errorFileType:'File "%fileName%" is incorrect',errorOldBrowser:"Your browser can not upload files. Update to the latest version"},e.lang.ru={upload:"Загрузить",abort:"Остановить",remove:"Удалить",complete:"Готово",error:"Ошибка",errorLoad:"Ошибка при загрузке файла",errorBadStatus:"Ошибка при загрузке файла. Некорректный запрос.",errorFilesLimit:"Количество выбранных файлов превышает лимит (%filesLimit%)",errorSizeLimit:'Файл "%fileName%" превышает предельный размер (%sizeLimit%)',errorFileType:'Файл "%fileName%" является некорректным',errorOldBrowser:"Обновите ваш браузер до последней версии"},e.lang.es={upload:"Subir",abort:"Cancelar",remove:"Eliminar",complete:"Cargado",error:"Error",errorLoad:"Error al cargar el archivo",errorBadStatus:"Error al cargar el archivo. Solicitud no válida.",errorFilesLimit:"El número de archivo selecccionados excede el límite (%filesLimit%)",errorSizeLimit:'El archivo "%fileName%" excede el limite de tamaño (%sizeLimit%)',errorFileType:'El archivo "%fileName%" es inválido',errorOldBrowser:"Tu navegador no puede subir archivos. Actualiza a la última versión"},e.lang.pt={upload:"Enviar",abort:"Cancelar",remove:"Remover",complete:"Enviado",error:"Erro",errorLoad:"Erro ao carregar o arquivo",errorBadStatus:"Erro ao carregar o arquivo. Pedido inválido.",errorFilesLimit:"O número de arquivos selecionados excede o limite (%filesLimit%)",errorSizeLimit:'Arquivo "%fileName%" excede o limite (%sizeLimit%)',errorFileType:'Arquivo "%fileName%" inválido',errorOldBrowser:"Seu navegador não pode enviar os arquivos. Atualize para a versão mais recente"},e});
//# sourceMappingURL=fileup.min.js.map
